# EDAMAME Endpoint Threat Models

## Table of Contents
- [Overview](#overview)
- [Database Generation and Management](#database-generation-and-management)
  - [Port Vulnerability Database](#port-vulnerability-database)
  - [Vendor Vulnerability Database](#vendor-vulnerability-database)
  - [Device Profile Database](#device-profile-database)
  - [Whitelist Database](#whitelist-database)
  - [Database Integrity and Updates](#database-integrity-and-updates)
- [Threat Dimensions](#threat-dimensions)
- [Naming Conventions](#naming-conventions)
- [Model Structure](#model-structure)
  - [JSON Format](#json-format)
  - [Key Fields](#key-fields)
- [Implementation Types](#implementation-types)
  - [System Checks](#system-checks)
  - [Command Line Checks](#command-line-checks)
  - [Business Rules](#business-rules)
- [Platform Coverage](#platform-coverage)
- [Security Assessment](#security-assessment)
  - [Severity Classification](#severity-classification)
  - [Compliance Frameworks](#compliance-frameworks)
- [Privacy Protection](#privacy-protection)
  - [Important Note on Business Rules](#important-note-on-business-rules)
- [Additional Features](#additional-features)
  - [Internationalization](#internationalization)
  - [Implementation Details](#implementation-details)
  - [Remediation Guidance](#remediation-guidance)
- [EDAMAME Ecosystem](#edamame-ecosystem)

## Overview

This repository contains the threat models used by the EDAMAME Security application to compute its Security Score. These models are based on industry-standard benchmarks including NIST and CIS, as well as other authoritative sources.

The EDAMAME Security platform leverages these models to provide comprehensive security posture assessment while ensuring user privacy and preventing administrative overreach.

## Database Generation and Management

EDAMAME Security relies on several specialized databases that power its detection capabilities. These databases are maintained through a combination of automated scripts and manual curation to ensure accuracy and relevance.

### Port Vulnerability Database

The `lanscan-port-vulns-db.json` database catalogs vulnerabilities associated with TCP ports. This database is automatically generated and updated using the `build-port-vulns-db.py` script which:

1. Retrieves port service descriptions from Nmap's service database
2. Queries the MITRE CVE database for vulnerabilities associated with each port
3. Filters vulnerabilities to include only those from the past 5 years
4. Verifies that vulnerability descriptions explicitly mention the port
5. Adds metadata including service names, descriptions, and protocol information
6. Generates a cryptographic signature for database integrity verification

The port vulnerability database enables EDAMAME to identify potentially vulnerable services running on endpoints within a network scan.

### Vendor Vulnerability Database

Similarly, the `lanscan-vendor-vulns-db.json` database tracks vulnerabilities associated with hardware vendors. It is generated by `build-vendor-vulns-db.py` which:

1. Retrieves vendor information from Wireshark's OUI database
2. Processes and normalizes vendor names for consistent matching
3. Queries the MITRE CVE database for vulnerabilities associated with each vendor
4. Retains only recent CVEs (past 4 years)
5. Organizes vulnerabilities by vendor with appropriate metadata
6. Signs the database for integrity verification

This database helps EDAMAME evaluate potential risks associated with specific hardware vendors detected on the network.

### Device Profile Database

The `lanscan-profiles-db.json` file contains rules for identifying device types based on their network characteristics. Unlike the vulnerability databases, this is primarily maintained manually to ensure accurate device type identification. The database:

1. Defines device types (printers, routers, IoT devices, etc.)
2. Contains logical rules for identifying each device type based on:
   - Open ports
   - mDNS service advertisements
   - Vendor information
   - Hostnames
   - Service banners
3. Implements complex condition trees using AND/OR logical operators
4. Supports negation of conditions for more precise matching

This database powers EDAMAME's device identification capabilities, allowing it to recognize and categorize devices on local networks.

### Whitelist Database

The `whitelists-db.json` database defines allowable network connections for different environments and scenarios. It contains:

1. Base whitelists for essential EDAMAME functionality
2. Specialized whitelists for development and CI/CD environments
3. Platform-specific whitelists (macOS, Linux, Windows)
4. Hierarchical definitions with inheritance support

Each whitelist entry can specify:
- Domains (including wildcard patterns)
- IP addresses (both specific and network ranges)
- Ports and protocols
- Autonomous System information (AS number, country, owner)
- Process-specific restrictions

This database enables EDAMAME to distinguish between legitimate and potentially unauthorized network connections, which is essential for security posture assessment.

### Database Integrity and Updates

All EDAMAME databases include:
- A timestamp indicating when they were last updated
- A cryptographic signature for integrity verification
- A structured format that supports easy parsing and validation

These databases are designed to be updated seamlessly from trusted sources while maintaining user privacy and security.

## Threat Dimensions

Security threats are categorized along 5 key dimensions:

| Dimension | Description |
|-----------|-------------|
| **Applications** | Application authorizations, code signing, EPP/antivirus, etc. |
| **Network** | Network configuration, exposed services, unsafe connections |
| **Credentials** | Password policies, biometrics, 2FA, exposed credentials |
| **System Integrity** | MDM profiles, jailbreaking, 3rd party administrative access |
| **System Services** | System configuration, service vulnerabilities |

## Naming Conventions

Threat names follow these conventions:
- Describe the threat directly (not its remediation)
- No hyphens (`-`)
- Spaces are preferred over underscores (`_`)
- No special characters
- Lowercase except for acronyms and commercial names
- Example: `Chrome not uptodate`

## Model Structure

Each threat model is structured as a JSON file that defines:
1. **Threat metadata**: Information about the threat, including its name, description, severity, and impact
2. **Detection logic**: The checks and conditions used to detect the presence of the threat
3. **Remediation guidance**: Recommended actions to mitigate the threat
4. **References**: Links to standards, benchmarks, and other sources of information

### JSON Format

Each threat model file follows a standardized format:

```json
{
  "name": "threat model [Platform]",
  "extends": "none",
  "date": "Last update date",
  "signature": "Cryptographic signature of the model",
  "metrics": [
    {
      "name": "Threat name",
      "metrictype": "bool",
      "dimension": "One of the 5 dimensions",
      "severity": 1-5,
      "scope": "Platform-specific or generic",
      "tags": ["Compliance standards", "Benchmarks"],
      "description": [
        { "locale": "EN", "title": "Title", "summary": "Description" },
        { "locale": "FR", "title": "Titre", "summary": "Description" }
      ],
      "implementation": { ... },
      "remediation": { ... },
      "rollback": { ... }
    }
  ]
}
```

### Key Fields

**Top Level Properties:**
- **name**: The unique identifier of the threat model
- **extends**: Inheritance model, if applicable 
- **date**: Last update timestamp
- **signature**: Cryptographic signature for integrity verification
- **metrics**: Array of threat definitions

**Metric Properties:**
- **name**: The threat identifier
- **metrictype**: Type of measurement (typically boolean)
- **dimension**: The security dimension the threat belongs to
- **severity**: Impact rating from 1 (low) to 5 (critical)
- **scope**: Whether the threat is platform-specific or generic
- **tags**: Compliance references (e.g., CIS Benchmark, ISO 27001, SOC 2)
- **description**: Localized explanations of the threat
- **implementation**: Detection logic
- **remediation**: Steps to resolve the threat
- **rollback**: Steps to revert remediation if needed

## Implementation Types

Threat models employ different detection methods depending on the nature of the security check:

### System Checks
Direct checks of system configuration, file presence, or settings that can be evaluated through standard APIs.

### Command Line Checks
Safe, predefined commands that gather information about the system state. These commands are carefully vetted to ensure they cannot cause harm to the system.

### Business Rules
Specialized checks that execute local scripts in userspace, leveraging the `EDAMAME_BUSINESS_RULES_CMD` environment variable. These scripts operate entirely on the user's device and implement organization-specific security policies without compromising user privacy.

The business rules framework allows organizations to define custom security checks while ensuring that:
- Scripts run locally in userspace only
- Only the final check result (pass/fail) is transmitted when reporting the security score
- The detailed output of the script remains available only on the local device
- No sensitive user data is sent to remote servers

This approach prevents potential abuse by administrators while maintaining the privacy and security of end users. Business rules can only access information that a normal user process could access, providing an additional layer of protection against privacy violations.

## Platform Coverage

EDAMAME provides threat models for multiple platforms:

| Platform | Coverage |
|----------|----------|
| **Android** | Android 11+ |
| **iOS** | iOS 15+ |
| **Linux** | Various distributions |
| **macOS** | macOS-specific threats |
| **Windows** | Windows-specific threats |

Each platform model contains:
1. **Platform-specific threats**: Threats unique to the platform's architecture
2. **Generic threats**: Common threats applicable across multiple platforms
3. **Implementation differences**: Platform-appropriate detection methods for similar threats

## Security Assessment

### Severity Classification

Threats are classified on a scale from 1 to 5:

| Level | Severity | Description |
|-------|----------|-------------|
| 1 | **Low** | Represents good security practice but minimal immediate risk |
| 2 | **Medium-Low** | May represent a security weakness |
| 3 | **Medium** | Significant security risk in specific circumstances |
| 4 | **High** | Serious security risk for most users |
| 5 | **Critical** | Severe security risk requiring immediate remediation |

### Compliance Frameworks

Threat models leverage industry standards and compliance frameworks:

| Framework | Description |
|-----------|-------------|
| **CIS Benchmarks** | Center for Internet Security standardized configurations |
| **ISO 27001/2** | International security management standards |
| **SOC 2** | Service Organization Control framework |
| **Personal Posture** | EDAMAME-specific recommendations for personal device security |

## Privacy Protection

EDAMAME's threat model implementation follows a privacy-by-design approach. The security assessment framework ensures that:

1. Only the result of a check (pass/fail/not applicable) is transmitted when reporting the security score
2. Raw data and detailed script outputs remain on the local device
3. Checks cannot access privileged information beyond what's available to the user
4. No personally identifiable information is collected or transmitted without explicit consent

This architecture intentionally prevents administrative abuse of security checks and guarantees user privacy, in line with EDAMAME Technologies' commitment to building security tools that respect user autonomy and privacy.

### Important Note on Business Rules

While the threat models included in this repository have been carefully vetted by EDAMAME Technologies to respect user privacy, the **Business Rules** functionality requires special attention:

The `EDAMAME_BUSINESS_RULES_CMD` environment variable allows organizations to define and execute custom security checks through user-supplied scripts or commands. Unlike EDAMAME's built-in models, **these custom commands are NOT pre-vetted** by EDAMAME Technologies.

It is the responsibility of the user or organization to ensure that any custom business rule commands:
- Do not collect or transmit sensitive user data without appropriate consent
- Operate only within appropriate permission boundaries
- Respect user privacy and organizational data handling policies
- Do not contain malicious code that could compromise security

When implementing custom business rules, carefully review all scripts to verify they align with your privacy standards and security requirements. Remember that while the EDAMAME framework only transmits the final pass/fail result of these checks, the scripts themselves have access to whatever information is available to the user account running them.

## Additional Features

### Internationalization

Threat descriptions support multiple languages, currently:
- English (EN)
- French (FR)

Each threat description, remediation step, and user-facing element is internationalized to provide native language support.

### Implementation Details

Each threat implementation contains:
- **system**: Target operating system
- **minversion/maxversion**: Version compatibility range
- **class**: Implementation method (internal, command, business_rules)
- **elevation**: Required permission level (user, admin)
- **target**: Specific check to perform
- **education**: Optional educational materials

### Remediation Guidance

Remediation paths include:
- **Direct links**: To official documentation for standard remediation
- **HTML content**: Rich formatted guidance for complex issues
- **Internal tools**: For threats that can be addressed through EDAMAME tooling

## EDAMAME Ecosystem

These threat models are used throughout the EDAMAME security ecosystem:

- **EDAMAME Core**: The core implementation used by all EDAMAME components (closed source)
- **[EDAMAME Security](https://github.com/edamametechnologies)**: Desktop/mobile security application with full UI and enhanced capabilities (closed source)
- **[EDAMAME Foundation](https://github.com/edamametechnologies/edamame_foundation)**: Foundation library providing security assessment functionality
- **[EDAMAME Posture](https://github.com/edamametechnologies/edamame_posture_cli)**: CLI tool for security posture assessment and remediation
- **[EDAMAME Helper](https://github.com/edamametechnologies/edamame_helper)**: Helper application for executing privileged security checks
- **[EDAMAME CLI](https://github.com/edamametechnologies/edamame_cli)**: Interface to EDAMAME core services
- **[GitHub Integration](https://github.com/edamametechnologies/edamame_posture_action)**: GitHub Action for integrating posture checks in CI/CD
- **[GitLab Integration](https://gitlab.com/edamametechnologies/edamame_posture_action)**: Similar integration for GitLab CI/CD workflows
- **[Threat Models](https://github.com/edamametechnologies/threatmodels)**: Threat model definitions used throughout the system
- **[EDAMAME Hub](https://hub.edamame.tech)**: Web portal for centralized management when using these components in team environments

## Author

EDAMAME Technologies